### 7-1
- INTEL Coreマイクロアーキテクチャを採用したプロセッサ内及びPCH内で、主要なデバイスが接続されるバスは**PCI**である
  - PCH
    - 周辺装置を接続するためのハブである
  
### 7-2
- lspciコマンドで表示できる情報として適切なもの
  - **デバイスのIRQ情報**
  - **バススピード**
  - **デバイスのベンダID**
```
$ lspci
0903:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)
0ad0:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)
11c6:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)
14bb:00:00.0 SCSI storage controller: Red Hat, Inc. Virtio 1.0 filesystem (rev 01)
```
  lspciコマンドはシステムのすべてのPCIバスと、接続されているデバイスに関する情報を表示する<br />
  なお、**-s**オプションで、特定のバス、デバイス、機能を指定することができる<br />
  あわせて、**-v**オプションで詳細情報を表示することができる

### 7-3
- USBに接続されたデバイスの情報を表示するコマンドは、**lsusb**コマンドである
  - lsusbコマンドは、USBバスと、接続されているデバイスに関する情報を表示する。
  - 主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -t | USBデバイスの物理的な階層情報を表示する |
    | -s | 「Bus番号:デバイス情報」により表示するデバイスを指定する |
    | -v | 詳細情報を表示する |

### 7-4
- IRQの情報が確認できるファイルとして適切なものは、**/proc/interrupts**である
  ```
  $ cat /proc/interrupts
           CPU0       CPU1       CPU2       CPU3
   8:          0          0          0          0   IO-APIC   8-edge      rtc0
   9:          0          0          0          0   IO-APIC   9-fasteoi   acpi
  24:          0          1          0          0  Hyper-V PCIe MSI 3623878656-edge      virtio0-config
  25:          0          0       2966          0  Hyper-V PCIe MSI 3623878657-edge      virtio0-virtqueues
  26:          0          0          0          0  Hyper-V PCIe MSI 2415919104-edge      virtio1-config
  27:          0        181          0          0  Hyper-V PCIe MSI 2415919105-edge      virtio1-requests
  ```
  - IRQは**割り込み要求**のことであり、デバイスがシステムに処理を要求するときに発生する

### 7-5
- Linuxカーネルのモジュールの状態を表示するコマンドとして適切なものは**lsmod**である
  - lsmodコマンドは、現在システムにロードされているモジュールの状態を表示するコマンドである
  - **/proc/modules**ファイルの内容が読み込まれて表示される
    ```
    $ lsmod
    Module                  Size  Used by
    ```

  - カーネル
    - 高度にハードウェアを認識・制御し、ルートファイルシステムのマウントなど様々な初期化処理を行う
    - **/sbin/init**を起動する
  
  - コマンドの説明
    | コマンド | 説明 |
    | ---- | ---- |
    | lsusb | USBデバイスに関する情報を表示する |
    | lsmod | カーネルのモジュールの状態を表示する |
    | lspci | PCIパスに接続されたデバイスの情報を表示する |
    | modprobe | カーネルへモジュールの追加や削除を行う |

### 7-6
- 必要な依存性モジュールをロードするコマンドとして適切なものは**modprobe**である
  - modprobeは、指定されたモジュールの依存関係を確認し、必要なモジュールを自動的に追加、もしくは削除する
  - modprobeの構文
    - modprobe [オプション] [モジュール名]

  - 主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -r, --remove | モジュールを削除する |
    | --show-depends | モジュールの依存関係を列挙する |
    | -c, --showconfig | 設定ファイルの内容を表示する |


### 7-7
- ACPIイベントは、**電源ボタンの押下**と**ノートPCのフタの閉/開**
  - ACPI(Advanced Configuration and Power Interface)は、PC/AT互換機の電源制御の統一規格として採用された採用されたハードウェアコンポーネントの電源管理のための規格

### 7-8
- SysV initを使用したシステムで最初にカーネルが生成するユーザプロセスの絶対パスは、**sbin/init**である

### 7-9
- 「grub-install /dev/sda」を実行すると、**必要なファイルをインストールしてブートローダを構成する**
  - GRUB or GRUB2
    - GNUで開発されたブートローダで、GRUBの起動画面から起動OSの選択、エントリの編集、コマンドラインによる操作などを実行可能
    - インストールには、rootユーザーが/sbin/grub-installコマンドを実行して行う
      - 引数にはインストールするディスクのデバイス名を指定する

  - ブートローダ
    - 記憶装置(HDD)内のカーネルをロードし、制御を移す

### 7-10
- GPT(GUID Partition Table)の説明で正しいものは、
  - **EFI規格の中の機能の1つである**
  - **ディスクにはGUIDが割り当てられる**
  - **パーティションにはGUIDが割り当てられる**
  
  GPT(GUID Partition Table)はMBR(Master Boot Record)に代わるハードディスクのパーティション規格であり、EFI(Extensible Firmware Interface)の機能1つである<br />
  大容量ハードディスクに対応する規格としてインテル社が提唱した

### 7-11
- ブートローダであるGRUBの設定ファイルとして適切なものは、
  - **/boot/grub/menu.lst**
  - **/boot/grub/grub.conf**

  - 主な設定項目
    | 項目 | 説明 |
    | ---- | ---- |
    | default | デフォルトで起動するOSを定義する。titleでエントリされた何番目のものかを表す。最初のtitleエントリは0番目 |
    | timeout | OSを自動起動するまでの待機時間を定義する |
    | splashimage | GRUBメニューの背景画像を指定する |
    | hiddenmenu | GRUBメニューを非表示にする |
    | title | 起動するOSに対して名前を定義する。マルチブート環境の場合は、複数定義する。1つのtitleエントリは、次のtitle行か、ファイルの終わりまでが設定内容となる |
    | root | GRUBのルートディレクトリを定義する。カーネルや初期RAMディスクイメージが保存されているパーティションを指定する |
    | kernel | カーネルのイメージファイルとカーネルオプションを指定する |
    | initrd | 初期RAMディスクのイメージファイルを指定する |

  しかし、OSによってGRUB2で設定されている場合は、設定ファイルは、**/etc/default/grub**に設定情報が記載されている<br />
  ```
  $ cat /etc/default/grub
  GRUB_TIMEOUT=5
  GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
  GRUB_DEFAULT=saved
  GRUB_DISABLE_SUBMENU=true
  GRUB_TERMINAL_OUTPUT="console"
  GRUB_CMDLINE_LINUX="rhgb quiet"
  GRUB_DISABLE_RECOVERY="true"
  ```

### 7-12
- /boot/grub/grub.confで設定可能なものは、
  - **Linuxカーネル**
  - **初期RAMディスクイメージ**

### 7-13
- ブート時にカーネルに渡された引数を確認できるファイルは、**/proc/cmdline**である
  
  GRUB設定ファイル内にある、kernel項目ではカーネルのイメージファイルとカーネルに渡すオプションを指定する

  - 主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | ro | ルートパーティションを読み取り専用でロードする |
    | root= | ルートパーティションを指定する。ルートファイルシステムのパーティション名もしくわラベル名で定義する |
    | quiet | ほとんどのカーネルメッセージを抑制し、表示を行わない。指定しない場合は、起動処理の詳細情報が表示される |
### 7-14
- システム起動時にできるだけメッセージを表示しないカーネルのオプションは、**quiet**である

### 7-15
- UEFIのブートローダは、**EFIシステムパーティション**に配置されている
  - UEFI
    - UEFIブートエントリで指定されたEFIシステムパーティション中のブートローダをメモリにロードする
    - GPTというパーティション形式に対応しており、3TB以上のHDDからの起動をサポートする
    - GUIでの操作が可能となる
    - 最初にアクセスされる領域であるESPは「/boot/efi」にマウントされる

  - BIOS
    - 起動デバイスの順序を設定できる
    - 電源を入れると起動し、記憶装置(HDD)等に関して最低限の認識を行う
    - 起動する順にデバイスの先頭セクタにあるMBRを読み込み、ブートローダが得られたら制御を移す

  - PCの電源投入後、BIOSあるいわUEFIがLinuxのブートローダを読み込んで起動する
    - BIOSとUEFI
      | 起動プログラム | 説明 |
      | ---- | ---- |
      | BIOS | ディスクの先頭ブロック(MBR)に書き込まれたブートローダをメモリにロードする |
      | UEFI | UEFIブートエントリで指定されたEFIシステムパーティション中のブートローダをメモリにロードする |

### 7-16
- GRUB2をインストールするときに使用されるディレクトリやファイルとして、適切なものは
  - **/boot/grub/grub.cfg**
    - 設定ファイル。ディストリビューションによっては、/boot/grub2/grub.cfg
  - **/usr/lib/grub/i386-pc**
    - モジュールの置かれたディレクトリ。この下のモジュールがGRUB2のインストール時に/boot/grubの下にコピーされる

  - GRUB2のディレクトリと設定ファイル
    | 主なディレクトリと設定ファイル | 説明 |
    | ---- | ---- |
    | /boot/grub | 設定ファイルとモジュールの置かれたディレクトリ。ディストリビューションによっては、/boot/grub2 |
    | /boot/grub/grub.cfg | 設定ファイル。ディストリビューションによっては、/boot/grub2/grub.cfg |
    | /usr/lib/grub/i386-pc | モジュールが置かれたディレクトリ。この下のモジュールがGRUB2のインストール時に/boot/grubの下にコピーされて使用される |
    | /etc/grub.d | 設定ファイルgrub.cfgの生成時に実行されるスクリプトが置かれたディレクトリ。この下にある30_os-proberスクリプトはディスクにインストールされているOSを検索する。検知されたOSはgrub.cfgのmenuentryに登録される |

### 7-17
- EFIパーティション中にあるものとして、適切なものは、**第1ステージのブートローダ**である

  GRUB2は、FAT32あるいはvfatでフォーマットされたEFIパーティションの中のEFI/centos/ディレクトリ下のshim.efiファイルとgrubx64.efiファイルに格納される

  - shim.efiとgrubx64.efi
    | ブートローダ | 説明 |
    | ---- | ---- |
    | shim.efi | EFIがブートエントリを参照して呼び出す第1ステージのブートローダ。第2ステージのブートローダであるgrubx64.efiファイルを呼び出す |
    | grubx64.efi | 第1ステージのブートローダshim.efiから呼び出される第2ステージのブートローダ。grub.cfgファイルを読み込んでGRUB2起動画面を表示する。grub.cfgの設定に従ってカーネルとinitramfsをメモリにロードし、カーネルを起動する |

### 7-18
- GRUB2で有効なコマンドとして適切なものは、**initrd**と**insmod**

  - 主なGRUB2コマンド
    | 主なGRUB2コマンド(CentOS) | 主なGRUB2コマンド(Ubuntu) | BIOS | UEFI | 説明 |
    | ---- | ---- | ---- | ---- | ---- |
    | insmod | insmod | 〇 | 〇 | モジュールの動的ロード |
    | set | set | 〇 | 〇 | 変数の設定 |
    | linux16 | - | 〇 | - | Intelアーキテクチャのカーネルを16ビットリアルモードで起動。カーネルはその後プロテクトモードに移行する |
    | initrd16 | - | 〇 | - | linux16コマンドでカーネルを起動する場合に、カーネルが利用するinitramfsを指定 |
    | linuxefi | - | - | 〇 | UEFIのブートパラメータをカーネルに渡して、カーネルを起動 |
    | initrdefi | - | - | 〇 | linuxefiコマンドでカーネルを起動する場合に、カーネルが利用するinitramfsを指定 |
    | - | linux | 〇 | 〇 | カーネルを起動 |
    | - | initrd | 〇 | 〇 | カーネルが起動するinitramfsを指定 |

### 7-19
- GRUB2をインストールするコマンドラインとして適切なものは
  - **grub-install /dev/sda**
  - **grub2-install /dev/sda**

### 7-20
- initramfsについて正しい説明は
  - initramfsは圧縮アーカイブファイルである
  - 起動した後/run/initramfsにログが残る

  inframfsは、ディスク内に構築されたルートファイルシステムへアクセスするためのディスクのデバイスドライバやファイルシステムモジュールを含むディレクトリ構成として作成され、<br />
  それをcpioでアーカイブし、gzipで圧縮したファイルである。ただし、ファイル名のサフィックスは「.gz」ではなく「.img」となっている。<br />
  initramfsは/run/initramfsディレクトリ以下にログを記録する(エラーがあった場合はログに記録するが、通常は中身は空である。)

- 初期RAMディスク
  - カーネルイメージと同様に「/boot」ディレクトリに格納される
  - ファイルシステムへアクセスするのに必要なドライバやスクリプトが含まれている
  - カーネルのバージョンごとに内容が異なる

### 7-21
- システム立ち上げ時にカーネルが出力するメッセージをシステム起動後に確認したい場合に、実行するコマンドラインとして適切なものは**cat /var/log/dmesg**である

### 7-22
- システム起動時にカーネルが画面に表示するメッセージを表示するコマンドは、**dmesg**である

### 7-23
- /var/log/dmesgがリセットされるタイミングとして、適切なものは**dmesg --clearで明示的にリセットしたとき**である

### 7-24
- SysV initシステムのランレベルを変更する際には、**/etc/inittab**ファイルを編集する
  - RedHat系Linuxでの主な主なランレベルには、0, 1, 3, 5, 6がある  
    | 主なランレベル | サービス | 説明 | ターゲット | 
    | ---- | ---- | ---- | ---- |
    | 0 | 停止 | システムの説明 | poweroff.target |
    | 1/s/S | シングルユーザー | rootだけログイン可能。システムのメンテナンスで使用される | rescue.target |
    | 2 | マルチユーザー | テキストログイン可能。NSFはなし | multi-user.target |
    | 3 | マルチユーザー | rootだけでなく一般ユーザもログイン可能。コンソールに表示されたログインプロンプトからログインする | multi-user.target |
    | 4 | マルチユーザー | - | multi-user.target |
    | 5 | マルチユーザー + GUI画面 | ディスプレイマネージャのログイン画面からX Window Systemにログインする。[Ctrl] + [Alt] + [Fn]キーの操作によりコンソールからもログインする | graphical.target |
    | 6 | 再起動 | システムの再起動 | reboot.target |

  SysV initでは、/etc/inittabファイルに記述されたランレベルを基に、initプロセスがサービスを起動する。<br />
  ランレベルとはシステムの動作モードのことで、停止、再起動、稼働時のサービス提供/享受などを定義する

  - Upstart
    - SysVinitを改善した新しい仕組みであり、Red Hat Enterprise Linux(RHEL)やUbuntuに採用されていたが、現在はsystemdへの置き換えが進められている
      - 主な特徴
        - イベント駆動型
        - サービスやタスクを「ジョブ」という単位で扱う
        - サービスの並列起動処理が可能


### 7-25
- /etc/inittabファイルの説明として適切なものは、**システム起動後のデフォルトのランレベルを定義する**

### 7-26
- 以下のスクリプトがあり、適切なものは、
  - ランレベル1に移動したときに、K01myscript1のサービスを停止する
    - スクリプトファイルの先頭が「K」で始まるものは、停止(STOP)する
  - ランレベル2に移動したときに、S02myscript2のサービスを開始する
    - スクリプトファイルの先頭が「S」で始まるものは、開始(START)する
  ```
  /etc/rc1.d/K01myscript1
  /etc/rc2.d/S02myscript2
  ```

### 7-27
- ディスクパーティションに関して問題がいくつか発生したためメンテナンスを行い、現在、複数のユーザーがログイン中である。ユーザーを切断してメンテナンスタスクを安全に実行できるコマンドラインは、
  - **telinit 1**
  - **init 1**

  システムの稼働状態はinit、telinitやshutdownコマンド等で変更することが可能<br />
  telinitはinitに指示を与えてランレベルを変更するコマンドである。initに設定ファイルの再読み込みを指示するなどの機能もある。<br />
  ディストリビューションによっては/sbin/initにシンボリックリンクされている。
  shutdownこまんどは、ログインしているすべてのユーザーに対し、システム状態の変更通知が行われ、さらに変更までの猶予時間が設定可能

  - initコマンドの構文
    - init ランレベル
  - telinitコマンドの構文
    - telinit ランレベル

  - shutdownコマンドの構文
    - shutdown [オプション] 猶予時間 [メッセージ]

  - shudownコマンドの主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -h | システムの停止 |
    | -r | システムの再起動 |
    | -k | シャットダウンは行わず、ログイン中の全ユーザーにメッセージを送る |
    | -c | 実行中のシャットダウンをキャンセル |

### 7-28
- /etc/inittabファイルを変更後、即時にinitプロセスへ反映させるためには、**telinit -q**コマンドを実行する

### 7-29
- systemdのターゲット(target)の説明で誤っているものは、**ブートローダのカーネルオプションでデフォルトターゲットを変更する場合は、「systemd.target=」の後にターゲット名を指定する**である

  最近の主要なディストリビューションでは、サービスの管理はSysV initに代わり、systemdが採用されている<br />
  systemdはSysV initに代わる仕組みで、ソケットとD-BUSを管理することにより並列処理の機能を強化し、依存関係を定義してサービスを管理する<br />
  systemdはユニット(unit)によってシステムを管理する。ユニットとは、systemdの管理対象となる処理の単位を指す<br />
  systemdはファイルを直接編集することはなく、**systemctl**コマンドによって設定や表示などほどんど全ての管理が可能

  - D-Bus
    - D-Bus(Desktop Bus)は、プログラム同士が情報を伝達するプロセス間通信機構のひとつである
    - Linuxではdbus-daemonなどがプロセス間通信を行っている

  - systemctlコマンドの構文
    - systemctl [オプション] サブコマンド [unit名]

  - 主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -a(--all) | 非アクティブなユニットも含めてロードされているユニットをすべて表示する |
    | -l(--full) | unit名などを省略しないで表示する |
    | -t(type==) | 表示するユニットのタイプを指定する |

  - 主のなサブコマンド
    | サブコマンド | 説明 |
    | ---- | ---- |
    | start | ユニットを開始(アクティブ化)する |
    | restart | ユニットをリスタートする |
    | stop | ユニットを停止(非アクティブ化)する |
    | status | ユニットの状態を表示する |
    | enable | ユニットをenableにする。これによりシステム起動時にユニットは自動的に開始する |
    | disable | ユニットをdisableにする。これによりシステム起動時にユニットは自動的に開始しない |
    | list-units | アクティブなユニットをすべて表示する |
    | list-unit-files | インストールされているすべてのユニットを表示する |
    | get-default | 次回起動時のターゲットを表示する |
    | halt | システムを停止しhalt状態にする |
    | is-active| サービスが稼働しているかを確認する |
    | reboot | システムを再起動する |
    | restart | サービスを再起動する |
    | set-default | 次回起動時のターゲットを設定する |
    | poweroff | システムを停止し電源を切断する |

  - 主なターゲット
    | ターゲット | 説明 | SysV ランレベル |
    | ---- | ---- | ---- |
    | default.target | システム起動時のデフォルトターゲット。システムはこのターゲットまで立ち上がる。通常はmulti-user.targetあるいはgraphical.targetへのシンボリックリンク | - |
    | sysinit.target | システム起動時の初期段階のセットアップを行うターゲット | - |
    | rescue.target | 障害発生時やメンテナンス時に管理者が利用するターゲット。管理者はrootのパスワードを入力してログインし、メンテナンス作業を行う | 1 |
    | multi-user.target | テキストベースでのマルチユーザーのセットアップを行うターゲット | 3 |
    | graphical.target | グラフィカルログインをセットアップするターゲット | 5 |

  - 主なプロセス
    | 主な拡張子 | 説明 |
    | ---- | ---- |
    | systemd | systemdの本体となるプロセスで、initの代わりに常駐する |
    | systemd-journald | systemdが制御する、各サービスが出力するログを扱う |
    | systemd-logind | システムへのログイン、起動停止、電源ボタン操作などを管理する |
    | systemd-udevd | 従来のudevdに代わり、デバイスの動的変更、検出を行う |

### 7-30
- systemdで、デフォルトのターゲットユニットとしてmulti-user.targetを設定するコマンドラインは**systemctl set-default multi-user.target**である

### 7-31
- systemdにより管理されたhttpdサービスの起動コマンドは**systemctl start httpd.service**である

  - 主な拡張子
    | 主な拡張子 | 説明 |
    | ---- | ---- |
    | device | 各種デバイスを管理するUnit |
    | mount | ファイルシステムを管理するUnit |
    | service | サービスを制御するUnit |
    | swap | スワップ領域を管理するUnit |
    | target | 複数のサービスを1つのグループにするためのUnit |

### 7-32
- マシンアーキテクチャやカーネルリリースの情報を表示するコマンドは**uname**である
  - unameコマンドの構文
    - uname [オプション]
  - 主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -m | マシン(ハードウェア)のタイプを表示する |
    | -n | マシンのネットワークホスト名を表示する |
    | -r | OSのリリースを表示する |
    | -s | OSの名称を表示する |
    | -v | OSのバージョンを表示する |
    | -a | 情報すべてを表示する |
  
  オプションが特に指定されなかった場合には、-sオプションと同様の項目が表示される

### 7-33
- ホストを再起動するために、現在ログインしているユーザ全員にメッセージを送るコマンドラインとして適切なものは**wall**コマンドである
  - wallコマンドの構文  
    - wall [メッセージ]

  またshutdownコマンドを実行する際もメッセージを出力させることができる<br />
  次の実行例は、1分後に再起動しますが、現在ログインしているユーザーに「I will reboot after 5 minutes.」というメッセージを表示している
  ```
  shutdown -r +1 "I will reboot after 5 minutes."
  ```

### 7-34
- システム(OS)の稼働時間を調べるコマンドとして、適切なものは、**uptime**と**top**、**w**コマンドである

  - システム(OS)の稼働時間を表示させる際の詳細コマンド
    | コマンド | 説明 |
    | ---- | ---- |
    | uptime | 現在時刻、システム起動からの時間、システム上にいるユーザ数、システムの平均負荷が順に表示される |
    | w | ログインしている人とその人がしていることを表示する。ヘッダにuptimeと同じ内容が表示される |
    | top | プロセス情報と周期的にリアルタイムに表示する。1行目にはuptimeと同じ内容が表示される |