## chapter3

### 3-1
- システムでアクティブなプロセスをすべて表示するコマンドラインは、**ps ax**と**ps -ef**、**pstree**である
  - プロセス
    - 実行中のプログラムのことである
    - 主なプロセスを表示するコマンド
      | 主なコマンド | 説明 |
      | ---- | ---- |
      | ps | プロセスの情報を表示する基本的なコマンド |
      | pstree | プロセスの階層情報を表示する |
      | top | プロセスの情報を周期的にリアルタイムに表示する |

    - 主なオプション
      | 種類 | 主なオプション | 説明 | 
      | ---- | ---- | ---- |
      | UNIX | -e | 全てのプロセスを表示する |
      |  | -f | 詳細情報(完全なフォーマットでプロセス)を表示する | 
      |  | -l | 長いフォーマットで詳細情報を表示する |
      |  | -o | ユーザー定義のフォーマットで表示する |
      | BSD | a | 全てのプロセス(他のユーザーのプロセス)を表示する |
      |  | f | プロセスの親子関係をツリー状で表示する |
      |  | l | プロセスのnice値を表示する |
      |  | u | 詳細情報(プロセスの実行ユーザー名)を表示する |
      |  | x | 制御端末のないプロセス情報も表示する |

    - psコマンドを使用した際の主な表示項目
      | 主な項目 | 説明 |
      | ---- | ---- |
      | PID | プロセスID |
      | TTY | 制御している端末 |
      | TIME | 実行時間 |
      | CMD | コマンド(実行ファイル名) |

### 3-2
- 現在のシェルで実行中のプロセスの優先度を確認するためのコマンドラインとして、適切なものは、**ps -l**と**top**である
  - プロセスの優先度
    - プロセスの優先度は、**NI(nice)値**で表す

### 3-3
- オプションを指定せずにプロセスをツリー構造で表示するコマンドは、**pstree**である
  - 3-1の問題を参照する
  - pstreeコマンドでの主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -h | カレントのプロセスとその先祖プロセスを強調表示 |
    | -H PID | 指定したプロセスとその先祖プロセスを強調表示 |
    | -p | プロセスをIDを付けて表示 |

### 3-4
- initのプロセスIDとして適切なものは、**1**である
  - 基本プロセス(処理)が開始されるときは、数字の**1**から開始される

### 3-5
- プロセスのプライオリティ(優先度)をデフォルトから変更するコマンドは、**nice**である
  - 優先度は、**動的優先度**と**静的優先度**がある
    | 優先度 | 説明 |
    | ---- | ---- |
    | 動的優先度 | 静的優先度とCPU使用時間を基に計算され、CPUを使うほど優先度は低くなる。カーネル内部で100 ~ 139の範囲の値を持つ |
    | 静的優先度 | nice値により一定範囲でユーザーが設定可能。カーネル内部で100 ~ 139の範囲の値を持つ |
    
  - niceコマンドの主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -c(--adjustment) 優先度 | 優先度(-20 ~ 19)を指定する |

  - niceの設定仕様
    - nice値は、**-20 ~ 19**の値で変更可能
    - niceコマンドで、オプションで数値を指定しない場合のnice値は**10(0 + 10)**の優先度を付与する

### 3-6
- プロセスのプライオリティ(優先度)を変更する場合、設定可能な最大値は、**19**である
  - 3-5の問題を参照する

### 3-7
- 実行中のプロセスの優先度を変更するコマンドとして適切なものは、**top**と**renice**である
  - reniceコマンドの主なオプション
    | オプション | 説明 |
    | ---- | ---- |
    | -n 優先度 | 優先度(nice値)を指定する |
    | -p プロセスID | 対象のプロセスIDを指定する |
    | -g グループID | 対象プロセスのグループIDを指定する |
    | -u ユーザー | 対象プロセスのユーザーIDまたはユーザー名を指定する |
    
  - reniceコマンドの構文
    - renice [オプション] nice値 オプション 

  - topでの優先度変更方法
    - ➀topコマンドを実行後プロセス情報が表示されたら、キーボードから[r]キーをタイプする
    - ➁画面に「PID to renice:」が表示されるので、変更したいプロセスのPID(プロセスID)を入力し[Enter]を押下する
    - ➂画面に「Renice PID [指定したPID] to value:」が表示されるため、優先度を入力し[Enter]を押下する

### 3-8
- バックグラウンドで動作しているジョブをフォアグラウンドで動かすコマンドとして適切なものは、**fg**である
  - ジョブ
    - コマンドライン1行で実行された処理単位のことである
    - ジョブはシェルごとに管理され、「ジョブID」が振られる
    - 1行のコマンドラインで複数のコマンドが実行された場合でも、その処理全体を1つのジョブとして扱う
    - ジョブの種類は、**フォアグラウンドジョブ**と**バックグラウンドジョブ**の2種類がある
      | ジョブ | 説明 |
      | ---- | ---- |
      | フォアグラウンドジョブ | キーボードと端末情報を占有して対話的な操作をするジョブ。そのジョブが終了するまで端末画面上には次のプロンプトが表示されない。シェルごとに1つのみ |
      | バックグラウンドジョブ | キーボード入力を受け取ることができないジョブ。画面への出力設定によっては抑制される。複数のジョブを同時に実行することが可能。**バックグラウンドでジョブ(コマンド)を実行する際には、コマンドの末尾に「&」を付ける。** |
    - ジョブを制御する主なコマンド
      | コマンド | 説明 |
      | ---- | ---- |
      | jobs | バックグラウンドジョブと一時停止中のジョブを表示 |
      | Ctrl + z | 実行しているジョブを一時停止にする |
      | bg %ジョブID | 指定したジョブをバックグラウンドに移行 |
      | fg %ジョブID | 指定したジョブをフォアグラウンドに移行 |

### 3-9
以下のような実行例がある
```
$ myapp
[1] + 停止 myapp
$
```
- ユーザーからのコマンド入力を可能にしたままで、停止しているmyappを再開させるコマンドラインとして適切なものは、**bg myapp**である
  - 3-8の問題を参照する

### 3-10
- 現在バックグラウンドで走っているジョブをすべて表示するコマンドは、**jobs**である
  - 3-8の問題を参照する

### 3-11
- ログアウトした後もコマンドが終了することなく、バックグラウンドで実行を続けさせるコマンドラインとして適切なものは、**nohup コマンド名 &**である。
  - nohupコマンド
    - ログアウトしてもプログラムを実行し続けるには、**nohup**コマンドを使用する
    - 標準出力と標準エラー出力は、カレントディレクトリに「nohup.out」というファイル名でリダイレクトする
    - 書き込めない場合は、ホームディレクトリへ「nohup.out」というファイル名でリダイレクトする
    - コマンドの構文
      - nohup コマンド [引数]

### 3-12
- 「kill プロセスID」を実行したときにプロセスに送られるシグナルとして適切なものは、**SIGTERM(15)**である
  - シグナル
    - 割り込みによってプロセスに特定の動作をするように通知するための仕組みである
    - 通常、プロセスは処理を終えると自動的に消滅するが、プロセスに対してシグナルを送信することで外部からプロセスを終了することができる
    - シグナルは、キーボードによる操作や「kill コマンド」の実行などにより、実行中のプロセスに送信される
    - 主なシグナル
      | シグナル番号 | シグナル名 | 説明 | 
      | ---- | ---- | ---- |
      | 1 | SIGHUP | 端末の切断によるプロセスの終了 |
      | 2 | SIGINT | 割り込みによるプロセスの終了([Ctrl] + [c]で使用) | 
      | 9 | SIGKILL | プロセスの強制終了 |
      | 15 | SIGTERM | プロセスの終了(デフォルト)(killコマンドを実行した際に送られる) |
      | 18 | SIGCONT | 一時停止したプロセスを再開する |
      | 19 | SIGSTOP | 一時停止 |
      | 20 | SIGTSTP | 端末から入力された一時停止([Ctrl] + [z]で使用) |

    - killコマンド
      - 指定したプロセスIDのプロセスを終了させる
      - 主なオプション
        | オプション | 説明 |
        | ---- | ---- |
        | -s | 	指定したシグナル名またはシグナル番号を送信する |
        | -シグナル | 指定したシグナル名またはシグナル番号を送信する |
        | -l [] | シグナル名とシグナル番号の対応を表示する |
      - シグナルの送信には、killコマンドの他、**killall**コマンドも使用可能
      - コマンドの構文
        - kill [オプション] [シグナル名 | シグナル番号] プロセスID
        - kill [オプション] [シグナル名 | シグナル番号] %ジョブID
        - killall [オプション] [シグナル名 | シグナル番号] プロセス名

### 3-13
- 「kill 1234」と同じ動きをするコマンドラインとして適切なものは、**「kill -15 1234」**と、**「kill -s SIGTERM 1234」**である
  - 3-12の問題を参照する
    - killコマンドを明示的にシグナルを指定しない場合は、**SIGTERM(15)**が送信される
    - -sオプションは、シグナルを送信するオプションで省略可能

### 3-14
- [Ctrl] + [c]で送信されるシグナル番号として適切なものは、**SIGINT(2)**である
  - 3-12の問題を参照する
    - [Ctrl] + [z]が押された場合は、**SIGTSTP(20)**が送信される

### 3-15
- あるプロセスのPIDが1023のとき、このプロセスを終了させたいが、終了時にそのプロセスによるクリーンアップ(終了処理)を実行させる際のコマンドラインとして適切なものは、**kill -15 1023**または、**kill -SIGTERM 1023**である
  - 3-12の問題を参照する
    - クリーンアップ
      - 使っていたリソースの開放やロックファイルの削除などを行う
      - SIGTERM(15)でプロセスが終了しないような、やむを得ない場合は**SIGKILL(9)**を使用して強制終了する

### 3-16
- SIGUSR1シグナルをapache2という名前のプロセスに送信させる際のコマンドラインとして適切なものは、**killall -SIGUSR1 apache2**である
  - killallコマンド
    - 同じ名前のプロセスが複数存在し、それらをまとめて終了したい場合に利用する
    - また、killallコマンドと同様の処理を行う**pkill**コマンドや、プロセス名から現在実行中のプロセスを検索する**pgrep**コマンドも提供される
    - コマンドの構文
      - killall [オプション] [シグナル名 | シグナル番号] プロセス名

  - pkillコマンド
    - プロセスを指定して、終了シグナル(TERMシグナル)などの「シグナル」を送信するコマンドである
    - killallコマンドと違い、pkillコマンドの場合は対象とするプロセス名を正規表現で指定する
      - 例えば、「**pkill abc**」の場合は、「名前にabcを含むすべてのプロセス」が対象になる
    - コマンドの構文
      - pkill [オプション] [プロセス名などのパターン]
    - 主なオプション
      | オプション | 説明 |
      | ---- | ---- |
      | -(--signal) シグナル | 送信するシグナルを番号またはシグナル名で指定する |
      | -e(--echo) | 対象となったプロセスとプロセスIDを表示する |
      | -c(--count) | 該当するプロセス（シグナルを送ったプロセス）の個数を表示する |

  - pgrepコマンド
    - 現在実行中のプロセスを調べてユーザー名、UID、GIDなどを基にプロセスIDを検索する
    - コマンドの構文
      - pgrep [オプション] [パターン]
    - 主なオプション
      | オプション | 説明 |
      | ---- | ---- |
      | -t 端末 | 指定した端末で実行されているプロセスIDを検索する。「.」区切りで複数指定可能 |
      | -u euid | 指定された実行ユーザーIDに該当するプロセスIDを検索する。ユーザーは名前またはIDで指定し、「,」区切りで複数指定可能 |
      | -U uid | 指定された実ユーザーIDに該当するプロセスIDを検索する。ユーザーは名前またはIDで指定し、「,」区切りで複数指定可能 |

### 3-17
- jobsコマンドを実行すると以下のように表示される
  ```
  $ jobs
  [1] Running prog &
  [2] - Running search &
  [3] + Running top &
  ```
  上記のジョブのうち、topジョブを終了させるコマンドラインとして適切なものは、**kill %3**である
  - 3-12の問題を参照する
  - コマンドの構文
    - kill [オプション] [シグナル名 | シグナル番号] %ジョブID

### 3-18
- 特定のコマンドを秒数を指定し繰り返し実行させて、結果を端末に表示するコマンドは、**watch**である
  - watchコマンド
    - 指定されたコマンドを繰り返し実行し、その結果を表示する
    - プログラムの出力の経時変化を監視できる
    - デフォルトでは2秒おきに実行されるが、時間の間隔を変えたい場合は-nまたは--intervalを指定する
    - watchコマンドは中断([Ctrl] + [c])されるまで実行を続ける

### 3-19
- tmuxコマンドの説明で誤っているものは、**GUI端末の画面制御プログラム**である
  - tmux
    - 1つの物理的な端末画面から多数の端末を作成、アクセス、および制御することができる文字型端末の画面制御プログラムである
    - 1つの画面の中で複数の画面を起動して作業可能
    - sshによるリモートログイン時でも同様に利用可能
    - tmuxで使用される用語
      | 用語 | 説明 |
      | ---- | ---- |
      | セッション | tmuxの管理下にある仮想端末の単一の集合 |
      | ウインドウ | セッション内で管理される仮想ウインドウ |
      | デタッチ | セッションから切断 |
      | アタッチ | デタッチしたセッションに再接続 |
    - tmuxと同様の機能を提供するものとして「screen」コマンドもある
