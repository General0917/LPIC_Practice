# 10-1 TCP/IPの基礎

## TCP/IP
- インターネットで使用されるネットワークアーキテクチャ
  | OSI参照モデル | TCP/IP | プロトコル | 
  | ---- | ---- | ---- |
  | アプリケーション層 | アプリケーション層 | Telnet, FTP, SMTP, POPなど |
  | プレゼンテーション層 | アプリケーション層 | Telnet, FTP, SMTP, POPなど |
  | セッション層 | アプリケーション層 | Telnet, FTP, SMTP, POPなど |
  | トランスポート層 | トランスポート層 | TCPとUDP |
  | ネットワーク層 | インターネット層 | IP |
  | データリンク層 | ネットワークインターフェース層 | LAN, WAN |
  | 物理層 | ネットワークインターフェース層 | LAN, WAN |

## TCPとUDP
- TCP(Transmission Control Protocol)
  - コネクション型のプロトコル
  - 信頼性を確保したい場合はTCPを使う
- UDP(User Datagram Protocol)
  - コネクションレス型のプロトコル
  - 信頼性を確保する必要がない場合はUDPを使う

## IPとICMP
- IP(Internet Protocol)
  - IPはIPアドレスを元に経路を選択する
- ICMP(Internet Control Message Protocol)
  - ICMPはエラーメッセージや制御メッセージを送る

## IPアドレス
- TCP/IPが使う論理アドレス
- 32ビットのビット列
- 通常8ビットずつに区切って10進数で書く
  - 170.105.61.93を8ビットずつ区切る
    - 10101010.01101001.00111101.01011101

## ネットワーク番号とホスト番号
- IPアドレスのクラスによって異なる
  - クラスA
    - 先頭8ビットを10進数表記すると、1~126の範囲
      - <ruby>`0`1101010<rp>（</rp><rt>ネットワーク番号</rt><rp>）</rp></ruby> <ruby>11010001 00111101 01011101<rp>（</rp><rt>ホスト番号</rt><rp>）</rp></ruby>
  - クラスB
    - 先頭8ビットを10進数表記すると、128~191の範囲
      - <ruby>`10`101010 11010001<rp>（</rp><rt>ネットワーク番号</rt><rp>）</rp></ruby> <ruby>00111101 01011101<rp>（</rp><rt>ホスト番号</rt><rp>）</rp></ruby>
  - クラスC
    - 先頭8ビットを10進数表記すると、192~223の範囲
      - <ruby>`110`01010 11010001 00111101<rp>（</rp><rt>ネットワーク番号</rt><rp>）</rp></ruby> <ruby>01011101<rp>（</rp><rt>ホスト番号</rt><rp>）</rp></ruby>

## サブネットマスク
- 32ビットのビット列
- ネットワーク番号、サブネット番号が`1`
- ホスト番号が`0`

  - <ruby>10101010 11010001<rp>（</rp><rt>ネットワーク番号</rt><rp>）</rp></ruby> <ruby>00111101<rp>（</rp><rt>サブネット番号</rt><rp>）</rp></ruby></ruby> <ruby>01011101<rp>（</rp><rt>ホスト番号</rt><rp>）</rp></ruby>
    - ネットワーク番号とサブネット番号を1、ホスト番号を0にすると...
      - 11111111 11111111 11111111 00000000
    - 8ビットずつ区切って10進数にすると...
      - 255.255.255.0

## CIDR(Classless Inter-Domain Routing)
- サブネットマスクでネットワーク番号を識別する
  - IPアドレス
    - <ruby>01101010 11010001 0011<rp>（</rp><rt>ネットワーク番号</rt><rp>）</rp></ruby> <ruby> 1101 01011101<rp>（</rp><rt>ホスト番号</rt><rp>）</rp></ruby>
  - サブネットマスク
    - 11111111 11111111 1111 <ruby>|<rp>（</rp><rt>境界値</rt><rp>）</rp></ruby> 0000 00000000
  - 10進数での表記方法
    - 170.105.61.93/20

## ネットワークアドレスとブロードキャストアドレス
- IPアドレス
  - 170.105.61.90
- サブネットマスク
  - 255.255.255.224

- ネットワークアドレス
  - ホスト番号がすべて`0`
    - ネットワーク
      - 01000000

- ブロードキャストアドレス
  - ホスト番号がすべて`1`
    - ホスト範囲
      - 01000001
      - 01011110
    - ブロードキャスト
      - 01011111

## IPv4アドレス
- ループバックアドレス
  - 自分自身を表すアドレス
    - 127.0.0.1
- プライベートアドレス
  - 申請なしに使ってもいいアドレス
    - 10.0.0.0/8
    - 172.16.0.0/16 ~ 172.31.0.0/16
    - 192.168.0.0/24 ~ 192.168.255.0/24
- グローバルアドレス
  - Internetの外から見えるアドレス

## IPv6アドレス
- 128ビットのIPアドレス
- 16進数表記で、16ビットずつ`:`で区切る

  <ruby>2000:0000:0000:00C0<rp>（</rp><rt>ネットワークプレフィックス(IPv4でいうネットワーク番号)</rt><rp>）</rp></ruby>:
  <ruby>0230:DEAD:BEEF:0CD0<rp>（</rp><rt>インターフェースID(IPv4でいうホスト番号)</rt><rp>）</rp></ruby>

- 各セクションの先頭の0は、省略可能
  - 2000:0:0:C0:230:DEAD:BEEF:CD0
- 連続する0は、`::`と省略可能(1箇所だけ)
  - 2000::C0:230:DEAD:BEEF:CD0

- 先頭3ビットが001(16進数で、2000::3/)で始まるアドレスが、`グローバルアドレス`
- 先頭10ビットが1111 1110 10(16進数で、FE80::/10)で始まるアドレスが、`リンクローカルアドレス`
- ブロードキャストはなく、代わりにマルチキャストかエニーキャストを使用
  - `マルチキャスト`は、グループ全員宛
  - `エニーキャスト`は、グループのうち1台宛

## ポート番号
- 上位層のプロトコル(アプリケーション)を識別するための値
  - ウェルノウンポートは`0 ~ 1023`
  - ランダムポートは`1024 ~ 65535`
  - 代表的なプロトコルのウェルノウンポート番号
    | ウェルノウンポート番号 | プロトコル |
    | ---- | ---- |
    | 20 | FTP(データ) |
    | 21 | FTP(制御) |
    | 23 | Telnet |
    | 25 | SMTP |
    | 53 | DNS |
    | 80 | HTTP |
    | 110 | POP3 |
    | 119 | NNTP |
    | 139 | NetBIOSセッション |
    | 143 | IMAP4 |
    | 161 | SNMP |
    | 443 | HTTP over SSL(HTTPS) |
    | 465 | SMTP over SSL(SMTPS) |
    | 993 | IMAP over SSL(IMAPS) |
    | 995 | POP3 over SSL(POP3S) |

## /etc/serviceファイル
- ポート番号とサービスの対応付けを記述
  ```
  [root@centos7 ~]# cat /etc/services
  # Network services, Internet style
  #
  # Updated from https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml .
  #
  # New ports will be added on request if they have been officially assigned
  # by IANA and used in the real-world or are needed by a debian package.
  # If you need a huge list of used numbers please install the nmap package.

  tcpmux          1/tcp                           # TCP port service multiplexer
  echo            7/tcp
  echo            7/udp
  discard         9/tcp           sink null
  discard         9/udp           sink null
  systat          11/tcp          users
  daytime         13/tcp
  daytime         13/udp
  netstat         15/tcp
  qotd            17/tcp          quote
  chargen         19/tcp          ttytst source
  chargen         19/udp          ttytst source
  ftp-data        20/tcp
  ftp             21/tcp
  fsp             21/udp          fspd
  ssh             22/tcp                          # SSH Remote Login Protocol
  telnet          23/tcp
  smtp            25/tcp          mail
  time            37/tcp          timserver
  time            37/udp          timserver
  ```

## telnetコマンド
- 指定したホストへ、Telnetで接続する
  - 指定したホストをリモートでコマンド操作できる
- telnetコマンドの書式
  - telnet [ホスト [ポート番号]]
  - 192.168.1.128へTelnet接続する
    ```
    [root@centos7 ~]# telnet 192.168.1.128
    ```
  - www.sample.comのポート25番へTelnet接続する
    - SMTPのサーバプログラムと通信する
      ```
      [root@centos7 ~]# telnet www.sample.com 25
      ```

## ftpコマンド
- 指定したホストへFTPで接続する
  - ファイル転送ができる
- ftpコマンドの書式
  - ftp [ホスト]
    | サブコマンド | 説明 |
    | ---- | ---- |
    | ls [ファイル] | リモート側のファイル一覧を表示する |
    | pwd | リモート側のカレントディレクトリを表示する |
    | get ファイル | ファイルをダウンロードする |
    | mget 複数ファイル | 複数のファイルをダウンロードする |
    | put ファイル | ファイルをアップロードする |
    | mput 複数ファイル | 複数のファイルをアップロードする |
    | ascii | 転送モードをASCIIに設定する |
    | binary | 転送モードをバイナリに設定する |
    | quit | FTPを終了する |

## digコマンド
- DNSサーバに登録されている情報を表示する
  - DNSの名前解決が、正常にできるかどうかを確認できる
  - www.ai-plus.comの情報を問い合わせる
    ```
    [root@centos7 ~]# dig www.ai-plus.com

    ; <<>> DiG 9.9.4-RedHat-9.9.4-73.el7_6 <<>> www.ai-plus.com
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 61408
    ;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 512
    ;; QUESTION SECTION:
    ;www.ai-plus.com.               IN      A

    ;; ANSWER SECTION:
    www.ai-plus.com.        300     IN      A       172.67.135.78
    www.ai-plus.com.        300     IN      A       104.21.6.216

    ;; Query time: 6 msec
    ;; SERVER: 192.168.2.1#53(192.168.2.1)
    ;; WHEN: Mon Oct 30 05:41:32 JST 2023
    ;; MSG SIZE  rcvd: 76
    ```

## digコマンド(まとめ)
- digコマンドの書式
  - dig [オプション] [@DNSサーバ名] ホストまたはドメイン名 [検索タイプ]
    | オプション | 説明 |
    | ---- | ---- |
    | -x | IPアドレスからホスト名を検索する |

    | 検索タイプ | 説明 |
    | ---- | ---- |
    | a | IPアドレス |
    | any | すべての情報 |
    | mx | メールサーバの情報 |
    | ns | ネームサーバの情報 |

  - www.ai-plus.comのメールサーバ情報を問い合わせる
    ```
    [root@centos7 ~]# dig www.ai-plus.com mx

    ; <<>> DiG 9.9.4-RedHat-9.9.4-73.el7_6 <<>> www.ai-plus.com mx
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42899
    ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 512
    ;; QUESTION SECTION:
    ;www.ai-plus.com.               IN      MX

    ;; AUTHORITY SECTION:
    ai-plus.com.            900     IN      SOA     elma.ns.cloudflare.com. dns.cloudflare.com. 2323682421 10000 2400 604800 1800

    ;; Query time: 7 msec
    ;; SERVER: 192.168.2.1#53(192.168.2.1)
    ;; WHEN: Mon Oct 30 05:45:53 JST 2023
    ;; MSG SIZE  rcvd: 103
    ```

## whoisコマンド
- ドメインの情報を、whoisデータベースに問い合わせる
  - ドメイン名やIPアドレス、所有者情報がわかる
- whoisコマンドの書式
  - whois ターゲット[@サーバ名]
  - ai-plus.comのドメイン情報を問い合わせる
    ```
    [root@centos7 ~]# whois ai-plus.com
    Domain Name: AI-PLUS.COM
    Registry Domain ID: 1624055746_DOMAIN_COM-VRSN
    Registrar WHOIS Server: whois.discount-domain.com
    Registrar URL: http://gmo.jp
    Updated Date: 2023-10-29T15:21:49Z
    Creation Date: 2010-11-05T20:27:34Z
    Registry Expiry Date: 2024-11-05T21:27:34Z
    Registrar: GMO Internet Group, Inc. d/b/a Onamae.com
    Registrar IANA ID: 49
    Registrar Abuse Contact Email: abuse@gmo.jp
    Registrar Abuse Contact Phone: +81.337709199
    Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
    Name Server: ELMA.NS.CLOUDFLARE.COM
    Name Server: JOSH.NS.CLOUDFLARE.COM
    DNSSEC: unsigned
    URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
    >>> Last update of whois database: 2023-10-29T20:48:16Z <<<

    For more information on Whois status codes, please visit https://icann.org/epp
    (以下省略)
    ```

# 10-2 ネットワークの設定

## 名前解決に関連する設定
- 