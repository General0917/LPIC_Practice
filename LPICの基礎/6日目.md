# 6日目

## 1 ファイルの操作

### 1-1 ファイルの検索
- **locate**コマンドでファイルを検索できる
  - どこで保存したのか忘れてしまったファイルなどを名前で検索したいときは、**locate**コマンドを利用する
    ```
    # ファイルを名前で検索する際のコマンド書式
    locate ファイル名パターン

    # hostsを含むファイルもしくはディレクトリを検索
    $ locate hosts
    /etc/hosts
    /etc/cloud/templates/hosts.alpine.tmpl
    /etc/cloud/templates/hosts.arch.tmpl
    /etc/cloud/templates/hosts.debian.tmpl
    /etc/cloud/templates/hosts.freebsd.tmpl
    /etc/cloud/templates/hosts.gentoo.tmpl
    /etc/cloud/templates/hosts.photon.tmpl
    /etc/cloud/templates/hosts.redhat.tmpl
    /etc/cloud/templates/hosts.suse.tmpl
    (以下省略)
    ```
  - 「*」や「?」などのメタキャラクタを使うこともできる。その場合はファイル名パターンを引用符で囲む必要がある
    ```
    # メタキャラクタを使った検索例
    $ locate '*sh*locate'
    /usr/share/bash-completion/completions/fallocate
    /usr/share/doc/mlocate
    ```
  - 検索結果を絞り込むにはgrepコマンドを使用して絞り込むのが可能
    ```
    # grepを使った絞り込みの例
    # 以下の例はhostsと含まれているファイルとディレクトリを検索し、その検索結果をパイプ「|」で受け渡して、grepコマンドをかけて、「/etc」ディレクトリの配下にあるか検索している
    $ locate hosts | grep '^/etc'
    /etc/hosts
    /etc/cloud/templates/hosts.alpine.tmpl
    /etc/cloud/templates/hosts.arch.tmpl
    /etc/cloud/templates/hosts.debian.tmpl
    /etc/cloud/templates/hosts.freebsd.tmpl
    /etc/cloud/templates/hosts.gentoo.tmpl
    /etc/cloud/templates/hosts.photon.tmpl
    /etc/cloud/templates/hosts.redhat.tmpl
    /etc/cloud/templates/hosts.suse.tmpl
    ```
  - locateコマンドは、リアルタイムでファイルを検索しているのではなく、あらかじめ作成済みのファイル名データベースを使って検索している
    - したがって、ファイル名データベース更新後に作成されたファイルは検索することができない
    - ファイル名データベースを更新するには、**updatedb**コマンドを実行する
    - updatedbコマンドはroot(管理者)ユーザーのみが実行可能
      ```
      # ファイル名データベースの更新
      $ su -
      Password:

      $ updatedb
      ```
- **find**コマンドで多様な条件によるファイル検索ができる
  - ファイル名だけでなく、様々な条件を指定して、リアルタイムでファイル名を検索できるのが**find**コマンドである。1
    - 主な検索式
      | 検索式 | 説明 |
      | ---- | ---- |
      | -name | ファイル名を指定する |
      | -size | ファイルサイズを指定する(例：10c(10バイト), 10k(10KB), +10K(10KB以上)) |
      | -atime | ファイルの最終アクセス日を指定する(例：3(3日前), +3(3日よりも前), -3(3日以内)) |
      | -amin | ファイルの最終アクセス時刻を〇分前で指定する |
      | -mtime | ファイルの最終修正日を指定する |
      | -mmin | ファイルの最終更新時刻を〇分前で指定する |
      | -perm | ファイルのアクセス権を指定する(例：664(rw-rw-r--), +444(少なくとも全ユーザーが読み取りできる)) |
      | -type | ファイルタイプを指定する(例：f(ファイル), d(ディレクトリ), l(シンボリックリング)) |
    - findコマンドの基本的な使い方
      ```
      # リアルタイムでのファイル検索コマンド書式
      find [検索対象パス] [検索式]

      # findコマンドの基本的な使い方
      # 以下の例では、「/usr/bin」ディレクトリの中にある、ファイル名が「c」から始まる(バイナリー)ファイルを検索している
      # 検索対象パスが「/usr/bin」であり、検索条件式を「-name "c*"」としているので
      $ find /usr/bin -name "c*"
      /usr/bin/chvt
      /usr/bin/crontab
      /usr/bin/chgrp
      /usr/bin/cpupower
      /usr/bin/chmem
      /usr/bin/captoinfo
      /usr/bin/cpio
      /usr/bin/clear
      /usr/bin/curl
      /usr/bin/choom
      /usr/bin/cvtsudoers
      /usr/bin/cat

      # 複数の検索条件を指定
      # 以下の例ではファイルサイズが、10KBいない且つ、ファイルのアクセス日が1日以内であること
      $ find -size -10k -atime -1
      ./.bash_profile
      ./.bash_history
      ./.bashrc
      ```
    - findコマンドはただ単にファイルを検索するだけではなく、**-exec**を付けることで、検索して見つかったファイルに対して、何らかの操作を加えることも可能
      ```
      # 検索したファイルに対してコマンド実行する書式
      find [検索対象パス] [検索式] -exec 実行コマンド {} \;

      # 1年以上アクセスされていないファイルを削除
      $ find -atime +366 -exec rm {} \;
      ```

### 1-2 テキストファイルの内容検索
- 文字列のパワーんを表記する代表的な表現方法に**正規表現**がある
- **grep**コマンドでテキストファイルの内容を検索できる
- **grep**コマンドは正規表現が利用できる
     